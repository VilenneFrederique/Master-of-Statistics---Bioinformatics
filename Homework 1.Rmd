---
title: "Principles of Statistical Inference"
author: "Vilenne Frédérique"
date: "2021-2022"
output:
  pdf_document: default
  html_document: default
subtitle: "Homework 1"
---

# Assignment
Let X be a random variable with a Possion($e^{\Delta}$) distribution (with $\Delta \in \mathbb{R}$). The following 10 independent observations were taken from this distribution: 4, 3, 3, 1, 3, 1, 3, 0, 1, 5.

# 1. Find the method of moment estimate of Delta

We know that a Poisson distribution is usually written as $Poisson(\lambda)$. So in our case we can assume that $\lambda = e^{\Delta}$. So transforming out function we get:

$\Delta = ln(\lambda)$

So for obtaining out Method of Moments estimator for $\Delta$, we derive it under the form of $\lambda$. For a Poisson distribution we have that $E[X]=\lambda$. Hence, an estimate for $\lambda$ is the sample mean $\hat{\lambda} = \bar{X}$. Transforming this back to our case with $\Delta$ we get that $\Delta = ln(\lambda) = ln(\bar{X})$. Numerically this is equal to:

```{r}
x <- c(4, 3, 3, 1, 3, 1, 3, 0, 1, 5)
MoM_lambda <- mean(x)
MoM_delta <- log(MoM_lambda)
```

The method of moments for $\Delta$ is equal to $\Delta_{MoM} = 0.875$.

# 2. Find a (approximate or bootstrap) standard error for your method of moment estimate

A bootstrap approximate is given for the standard error of the method of moments estimate for $\Delta$. It consists out the following steps:

  1. Calculate the estimate for $\lambda$ with the method of moments
  2. Specify the amount of bootstrap replicates
  3. Create a vector to store the estimates for $\Delta$ in
  4. Sample a new sample B times from a Poisson distribution with $\lambda$ equal to our $\lambda_{MoM}$
  5. Estimate a new $\lambda_{MoM}$ by taking the mean of our newly sampled sample
  6. Transform it into $\Delta$ by taking the logarithm of $\lambda_{MoM}$ and store it in the vector
  7. Take the standard deviation of the $\Delta$-values in the vector

```{r}
# Our sample
x <- c(4, 3, 3, 1, 3, 1, 3, 0, 1, 5)

# Calculating lambda using method of moments
MoM_lambda <- mean(x)

# Amount of Bootstrap replicates
B <- 1000000

# Vector to store variables in
MoM_delta <- NULL

# Bootstrap for-loop
for(i in 1:B){
  x_sampled <- rpois(n = 10, lambda = MoM_lambda)
  lambda_estimates <- mean(x_sampled)
  MoM_delta[i] <- log(lambda_estimates)
}

# Determining the standard deviation of the MoM estimate
sd(MoM_delta)
```

The standard error of $\Delta_{MoM}$ is equal to 0.211 using a Bootstrap method with 10.000.000 iterations.

# 3. Plot the likelihood function (as a function of Delta)

The likelihood function of a Poisson distribution is given by:

$L(\lambda)= \prod_{i = 1}^{n}(x_i|\lambda)= \prod_{i = 1}^{n}\frac{\lambda^{x_i}e^{-\lambda}}{x_i!}$

Changing $\lambda$ for $\Delta$ where $\lambda = e ^ {\Delta}$. The likelihood is shown on the y-axis and the value for $\Delta$ is shown on the x-axis. 

```{r}
# Our sample
x_sample <- c(4, 3, 3, 1, 3, 1, 3, 0, 1, 5)

# Possible values for delta
delta <- seq(-0.5, 2, 0.01)

# Creating a data frame to store values in
prob_matrix <- data.frame(delta_value = numeric(), likelihood = numeric())

# For loop to compute the likelihood
for(value in delta){
  # Calculate the likelihood for each possible value of delta
  probability <- prod(exp(-exp(value))*exp(value)^x_sample / factorial(x_sample))
  
  # Store it in the dataframe
  Temp <- data.frame(value, probability)
  names(Temp) <- c("delta_value", "likelihood")
  prob_matrix <- rbind(prob_matrix, Temp)
}

plot(x = prob_matrix$delta_value, y = prob_matrix$likelihood, type = "l", main = "Likelihood function of Delta")
```


# 4. Find the maximum likelihood estimate of Delta

We derive the maximum likelihood estimate for $\lambda$ and transform this for $\Delta$:

$$
f(x|\lambda)= \frac{\lambda^xe^{-\lambda}}{x!} \\
L(\lambda)= \prod_{i = 1}^{n}(x_i|\lambda)= \prod_{i = 1}^{n}\frac{\lambda^{x_i}e^{-\lambda}}{x_i!} \\
log \space L(\lambda)=\sum_{i=1}^{n}x_ilog(\lambda)-n\lambda-\sum_{i=1}^{n}log(x_i!) \\
\frac{d}{d\lambda}log \space L(\lambda) = \frac{\sum_{i=1}^{n}x_i}{\lambda} - n = 0\\
\hat\lambda = \frac{1}{n}\sum_{i=1}^{n}x_i = \bar X \\
Transform \space for \space \Delta: \\
\Delta = ln(\lambda) = ln(\bar{X})
$$

```{r}
# Our sample
x <- c(4, 3, 3, 1, 3, 1, 3, 0, 1, 5)

# The MLE of lambda
MLE_lambda <- mean(x)

# The transformation back to Delta
MLE_delta1 <- log(MLE_lambda)
MLE_delta1
```

Our maximum likelihood estimate for $\Delta$ is equal to our method of moments estimate, $\Delta_{ML}=0.875$.

This can also be done within R itself making use of a negative log likelihood transformation and an MLE estimate using the stats4 package.

```{r}
# Our sample
x_sample <- c(4, 3, 3, 1, 3, 1, 3, 0, 1, 5)

#negative log likelihood
nLL <- function(delta){
   -sum(dpois(x = x_sample, lambda = exp(delta), log=TRUE))
}

#MLE
library(stats4)
fit1 = mle(nLL, start = list(delta= 0))
MLE_delta2 = coef(summary(fit1))[1,1]
MLE_delta2
```

Yielding the exact same results as the analytical derivation. 


# 5. Find an (approximate) standard error for your maximum likelihood estimate
The standard error is computed by sampling from a Poisson distribution using the value of maximum likelihood estimate found in exercise 4. The derivation of the maximum likelihood for a Poisson distribution is found in exercise 4. 

```{r}
# Setting parameters
nsim = 1000000
MLE_delta3 = NULL

# Looping to estimate the variability on our estimate
for (i in 1:nsim){
  
  # Sample from a Poisson distribution
  x_samples=rpois(n=10, lambda = exp(MLE_delta1))
  
  # Negative log-likelihood transformation
  nLL_transformation <- function(delta){
    -sum(dpois(x = x_samples, lambda = exp(delta), log=TRUE))
    }
  
  # Computing the MLE
  fit = mle(nLL_transformation, start = list(delta = 0))
  
  # Store it in a vector
  MLE_delta3[i] = coef(summary(fit))[1,1]
}                    

# Estimate the standard error
sd(MLE_delta3)
```

The standard error for the maximum likelihood estimate is equal to 0.211

# 6. Give an (approximate or bootstrap) confidence interval for Delta

A confidence interval for $\Delta$ is estimated using a bootstrap method. It consists out of a few steps:

  1. Compute the maximum likelihood estimate for $\lambda$
  2. Construct a for-loop to sample from a Poisson distribution
  3. Transform $\lambda$ into $\Delta$
  4. Compute the percentiles
  5. Construct a 95% confidence interval

```{r}
# Maximum likelihood estimator for lambda
MLE_lambda <- mean(x)

# Amount of Bootstrap estimates
B <- 1000000

# A dataframe to store the estimates in
delta <- NULL

# For-loop
for(i in 1:B){
  sampled <- rpois(n = 10, lambda = MLE_lambda)
  lambda_est <- mean(sampled)
  delta[i] <- log(lambda_est)
}

# Quantiles
Lower_quantile <- quantile(MLE_lambda - delta, 0.025)
Upper_quantile <- quantile(MLE_lambda - delta, 0.975)

# Confidence interval
Lower_bound <- MLE_lambda - Upper_quantile
Upper_bound <- MLE_lambda - Lower_quantile

Lower_bound
Upper_bound

```

The 95% confidence interval for $\Delta$ using bootstrap methods is equal to [0.405; 1.224] using 1.000.000 iterations. 